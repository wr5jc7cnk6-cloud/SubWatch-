<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SubWatch</title>

<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    background: #f5f5f7;
    margin: 0;
    padding: 16px;
  }
  h1 {
    text-align: center;
  }
  .card {
    background: #fff;
    border-radius: 12px;
    padding: 12px;
    margin-bottom: 12px;
  }
  .warn {
    color: red;
    font-weight: bold;
  }
  button {
    padding: 6px 10px;
    margin-top: 6px;
  }
  input {
    width: 100%;
    padding: 8px;
    margin: 4px 0;
  }
  nav {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 16px;
  }
</style>
</head>

<body>

<script>
  const nameInput = document.querySelector('input[placeholder="サービス名 (Netflixなど)"]');
  const priceInput = document.querySelector('input[placeholder="月額費用"]');
  const button = document.querySelector('button');
  const list = document.getElementById('subList');
  const totalEl = document.getElementById('total');

  let subs = [];

  button.addEventListener('click', () => {
    const name = nameInput.value;
    const price = Number(priceInput.value);

    if (!name || !price) {
      alert('入力してね');
      return;
    }

    subs.push({ name, price });

    render();
    nameInput.value = '';
    priceInput.value = '';
  });

  function render() {
    list.innerHTML = '';
    let total = 0;

    subs.forEach(sub => {
      const li = document.createElement('li');
      li.textContent = `${sub.name}：¥${sub.price}`;
      list.appendChild(li);
      total += sub.price;
    });

    totalEl.textContent = `合計：¥${total}/月`;
  }
</script>
<h1>SubWatch</h1>
<p id="total"></p>

<div id="list"></div>

<div class="card">
  <h3>サブスク追加</h3>
  <input id="name" placeholder="サービス名（Netflixなど）">
  <input id="cost" type="number" placeholder="月額費用">
  <button onclick="addSub()">追加</button><ul id="subList"></ul>
<p id="total"></p>
</div>

<script>
const KEY = "subs";
let subs = JSON.parse(localStorage.getItem(KEY)) || [];

function save() {
  localStorage.setItem(KEY, JSON.stringify(subs));
  render();
}

function addSub() {
  if (!name.value || !cost.value) return;
  subs.push({
    id: crypto.randomUUID(),
    name: name.value,
    monthlyCost: Number(cost.value),
    usageDates: []
  });
  name.value = "";
  cost.value = "";
  save();
}

function markUsed(id) {
  const s = subs.find(x => x.id === id);
  s.usageDates.push(new Date().toISOString());
  save();
}

function isWastedThisMonth(s) {
  const now = new Date();
  const count = s.usageDates.filter(d => {
    const date = new Date(d);
    return date.getMonth() === now.getMonth() &&
           date.getFullYear() === now.getFullYear();
  }).length;
  return count <= 1;
}

function render() {
  let total = 0;
  list.innerHTML = "";

  subs.forEach(s => {
    total += s.monthlyCost;
    const warn = isWastedThisMonth(s)
      ? `<span class="warn">⚠️ ほぼ未使用</span>`
      : "";

    list.innerHTML += `SubWatch（サブウォッチ）
      <div class="card">
        <strong>${s.name}</strong><br>
        ¥${s.monthlyCost}/月 ${warn}<br>
        <button onclick="markUsed('${s.id}')">今週使った</button>
      </div>
    `;
  });

  total.textContent = `月額合計：¥${total}`;
}

render();
</script>

</body>
</html>
