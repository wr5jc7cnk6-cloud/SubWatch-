<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>SubWatch</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: system-ui, sans-serif;
  background: #f5f5f5;
  padding: 20px;
}

.card {
  background: white;
  padding: 20px;
  border-radius: 12px;
  max-width: 400px;
  margin: auto;
}

input, button {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  margin-top: 10px;
}

button:disabled {
  background: #ccc;
}

.notice {
  color: red;
  font-weight: bold;
  margin-top: 10px;
}

.warning {
  color: #d35400;
  font-weight: bold;
  margin-top: 10px;
}

.total {
  margin-top: 15px;
  font-weight: bold;
}

.admin {
  margin-top: 20px;
  border-top: 1px dashed #ccc;
  padding-top: 10px;
}
</style>
</head>

<body>

<div class="card">
  <h2>SubWatch</h2>

  <input id="name" placeholder="ã‚µãƒ–ã‚¹ã‚¯å">
  <input id="price" type="number" placeholder="æœˆé¡æ–™é‡‘">

  <button id="addBtn" onclick="addItem()">è¿½åŠ </button>

  <p id="notice" class="notice"></p>
  <p id="warning" class="warning"></p>

  <ul id="list"></ul>

  <div class="total">
    åˆè¨ˆï¼ˆæœˆé¡ï¼‰ï¼šÂ¥<span id="total">0</span>
  </div>

  <div class="admin">
    <p>ğŸ”’ ç®¡ç†è€…è§£é™¤</p>
    <input id="adminPass" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
    <button onclick="unlock()">è§£é™¤</button>
  </div>
</div>

<script>
const ADMIN_PASSWORD = "0823";
const MAX_ADD = 5;
const WARNING_LIMIT = 50000;

let addCount = Number(localStorage.getItem("addCount")) || 0;
let total = Number(localStorage.getItem("total")) || 0;

document.getElementById("total").textContent = total;
checkWarning();
checkBan();

/* è¿½åŠ  */
function addItem() {
  if (isBanned()) return;

  addCount++;
  localStorage.setItem("addCount", addCount);

  if (addCount > MAX_ADD) {
    permanentBan();
    return;
  }

  const name = document.getElementById("name").value;
  const price = Number(document.getElementById("price").value);

  if (!name || !price) {
    alert("å…¥åŠ›ã—ã¦ãã ã•ã„");
    addCount--;
    localStorage.setItem("addCount", addCount);
    return;
  }

  const li = document.createElement("li");
  li.textContent = `${name}ï¼šÂ¥${price}`;
  document.getElementById("list").appendChild(li);

  total += price;
  localStorage.setItem("total", total);
  document.getElementById("total").textContent = total;

  checkWarning();

  document.getElementById("name").value = "";
  document.getElementById("price").value = "";
}

/* è­¦å‘Šãƒã‚§ãƒƒã‚¯ */
function checkWarning() {
  const warn = document.getElementById("warning");
  if (total > WARNING_LIMIT) {
    warn.textContent = "âš ï¸ è¿½åŠ ã—ã™ãã¦ã¾ã›ã‚“ã‹ï¼Ÿæœˆé¡5ä¸‡å††ã‚’è¶…ãˆã¦ã„ã¾ã™";
  } else {
    warn.textContent = "";
  }
}

/* æ°¸ä¹…BAN */
function permanentBan() {
  localStorage.setItem("ban", "PERMANENT");
  block("ä½œã‚Šã™ãã®ãŸã‚æ°¸ä¹…ã‚¢ã‚¯ã‚»ã‚¹ç¦æ­¢ã•ã‚Œã¾ã—ãŸ");
}

/* è¡¨ç¤ºåˆ¶å¾¡ */
function block(msg) {
  document.getElementById("addBtn").disabled = true;
  document.getElementById("notice").textContent = msg;
}

/* BANç¢ºèª */
function checkBan() {
  if (isBanned()) {
    block("æ°¸ä¹…ã‚¢ã‚¯ã‚»ã‚¹ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™");
  }
}

function isBanned() {
  return localStorage.getItem("ban") === "PERMANENT";
}

/* ç®¡ç†è€…è§£é™¤ */
function unlock() {
  const pass = document.getElementById("adminPass").value;
  if (pass !== ADMIN_PASSWORD) {
    alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");
    return;
  }

  localStorage.removeItem("ban");
  localStorage.removeItem("addCount");
  localStorage.removeItem("total");

  addCount = 0;
  total = 0;

  document.getElementById("total").textContent = "0";
  document.getElementById("warning").textContent = "";
  document.getElementById("addBtn").disabled = false;
  document.getElementById("notice").textContent = "";
  document.getElementById("adminPass").value = "";

  alert("åˆ¶é™ã¨åˆè¨ˆã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ");
}
</script>

</body>
</html>
