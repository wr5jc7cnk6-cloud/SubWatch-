<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>SubWatch</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: system-ui, sans-serif;
  background: #f5f5f5;
  padding: 20px;
}

.card {
  background: white;
  padding: 20px;
  border-radius: 12px;
  max-width: 400px;
  margin: auto;
}

input, button {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  margin-top: 10px;
}

button:disabled {
  background: #ccc;
}

.notice {
  color: red;
  font-weight: bold;
  margin-top: 10px;
}

.admin {
  margin-top: 20px;
  border-top: 1px dashed #ccc;
  padding-top: 10px;
}
</style>
</head>

<body>

<div class="card">
  <h2>SubWatch</h2>

  <input id="name" placeholder="ã‚µãƒ–ã‚¹ã‚¯å">
  <input id="price" type="number" placeholder="æœˆé¡æ–™é‡‘">

  <button id="addBtn" onclick="addItem()">è¿½åŠ </button>

  <p id="notice" class="notice"></p>
  <ul id="list"></ul>

  <div class="admin">
    <p>ğŸ”’ ç®¡ç†è€…è§£é™¤</p>
    <input id="adminPass" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
    <button onclick="unlock()">è§£é™¤</button>
  </div>
</div>

<script>
const ADMIN_PASSWORD = "0823";
const MAX_ADD = 5; // â† ã“ã“ãŒã€Œä½œã‚Šã™ãã€ã®åŸºæº–

let addCount = Number(localStorage.getItem("addCount")) || 0;
checkBan();

/* è¿½åŠ  */
function addItem() {
  addCount++;
  localStorage.setItem("addCount", addCount);

  if (addCount > MAX_ADD) {
    punish();
    return;
  }

  const name = document.getElementById("name").value;
  const price = document.getElementById("price").value;

  if (!name || !price) {
    alert("å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }

  const li = document.createElement("li");
  li.textContent = `${name}ï¼šÂ¥${price}`;
  document.getElementById("list").appendChild(li);

  document.getElementById("name").value = "";
  document.getElementById("price").value = "";
}

/* åˆ¶è£ */
function punish() {
  let level = Number(localStorage.getItem("banLevel")) || 0;
  level++;
  localStorage.setItem("banLevel", level);

  localStorage.removeItem("addCount");

  if (level === 1) setBan(3);
  else if (level === 2) setBan(10);
  else {
    localStorage.setItem("banUntil", "PERMANENT");
    block("æ°¸ä¹…ã‚¢ã‚¯ã‚»ã‚¹ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™");
  }
}

/* BANè¨­å®š */
function setBan(minutes) {
  const until = Date.now() + minutes * 60 * 1000;
  localStorage.setItem("banUntil", until);
  block(`ä½œã‚Šã™ãã®ãŸã‚ ${minutes}åˆ† ä½¿ç”¨ä¸å¯`);
}

/* ãƒ–ãƒ­ãƒƒã‚¯ */
function block(msg) {
  document.getElementById("addBtn").disabled = true;
  document.getElementById("notice").textContent = msg;
}

/* èµ·å‹•æ™‚ãƒã‚§ãƒƒã‚¯ */
function checkBan() {
  const until = localStorage.getItem("banUntil");
  if (!until) return;

  if (until === "PERMANENT") {
    block("æ°¸ä¹…ã‚¢ã‚¯ã‚»ã‚¹ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™");
    return;
  }

  const now = Date.now();
  if (now < Number(until)) {
    const remain = Math.ceil((Number(until) - now) / 60000);
    block(`ã‚ã¨ ${remain}åˆ† ä½¿ç”¨ä¸å¯`);
    setTimeout(checkBan, 60000);
  } else {
    clearBan();
  }
}

/* ç®¡ç†è€…è§£é™¤ */
function unlock() {
  const pass = document.getElementById("adminPass").value;
  if (pass !== ADMIN_PASSWORD) {
    alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");
    return;
  }
  clearBan();
  alert("åˆ¶é™ã‚’è§£é™¤ã—ã¾ã—ãŸ");
}

/* å®Œå…¨è§£é™¤ */
function clearBan() {
  localStorage.removeItem("banUntil");
  localStorage.removeItem("banLevel");
  localStorage.removeItem("addCount");
  document.getElementById("addBtn").disabled = false;
  document.getElementById("notice").textContent = "";
  document.getElementById("adminPass").value = "";
}
</script>

</body>
</html>
