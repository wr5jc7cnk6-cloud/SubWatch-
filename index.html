<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>SubWatch</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: system-ui, sans-serif;
  background: #f5f5f5;
  padding: 20px;
}

.card {
  background: white;
  padding: 20px;
  border-radius: 12px;
  max-width: 400px;
  margin: auto;
}

input, button {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  margin-top: 10px;
}

button:disabled {
  background: #ccc;
}

.notice {
  color: red;
  font-weight: bold;
  margin-top: 10px;
}
</style>
</head>

<body>

<div class="card">
  <h2>SubWatch</h2>

  <input id="name" placeholder="サブスク名">
  <input id="price" type="number" placeholder="月額料金">

  <button id="addBtn" onclick="addItem()">追加</button>

  <p id="notice" class="notice"></p>
  <ul id="list"></ul>
</div>

<script>
let addCount = 0;
let lastAddTime = 0;

const banLevel = Number(localStorage.getItem("banLevel")) || 0;
const banUntil = Number(localStorage.getItem("banUntil")) || 0;

checkBan();

/* 追加処理 */
function addItem() {
  const now = Date.now();

  // 連打判定（3秒以内に連続）
  if (now - lastAddTime < 3000) {
    punish();
    return;
  }

  lastAddTime = now;

  const name = document.getElementById("name").value;
  const price = document.getElementById("price").value;

  if (!name || !price) {
    alert("入力してください");
    return;
  }

  const li = document.createElement("li");
  li.textContent = `${name}：¥${price}`;
  document.getElementById("list").appendChild(li);

  document.getElementById("name").value = "";
  document.getElementById("price").value = "";
}

/* 制裁 */
function punish() {
  let level = Number(localStorage.getItem("banLevel")) || 0;
  level++;
  localStorage.setItem("banLevel", level);

  let minutes = 0;

  if (level === 1) minutes = 3;
  if (level === 2) minutes = 10;
  if (level >= 3) {
    localStorage.setItem("banUntil", Infinity);
    block("永久アクセス禁止されました");
    return;
  }

  const until = Date.now() + minutes * 60 * 1000;
  localStorage.setItem("banUntil", until);

  block(`${minutes}分間 機能使用不可`);
}

/* 使用不可処理 */
function block(message) {
  document.getElementById("addBtn").disabled = true;
  document.getElementById("notice").textContent = message;
}

/* 起動時チェック */
function checkBan() {
  const now = Date.now();
  const until = Number(localStorage.getItem("banUntil"));

  if (!until) return;

  if (until === Infinity) {
    block("永久アクセス禁止されています");
    return;
  }

  if (now < until) {
    const remain = Math.ceil((until - now) / 60000);
    block(`あと ${remain}分 使用不可`);
    setTimeout(checkBan, 60000);
  } else {
    localStorage.removeItem("banUntil");
    document.getElementById("addBtn").disabled = false;
    document.getElementById("notice").textContent = "";
  }
}
</script>

</body>
</html>
